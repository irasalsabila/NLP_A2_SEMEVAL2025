# Narrative Extraction for SemEval 2025

This repository contains the implementation, models, and predictions for the **Narrative Extraction Task** for SemEval 2025 Task 10. Our team, **telorbulat**, is listed on the [SemEval 2025 Leaderboard](https://propaganda.math.unipd.it/semeval2025task10/leaderboard.php).

---

## Project Overview

### Repository Structure

```plaintext
.
├── data
│   ├── predictions_train.csv
│   ├── subtask_3_train.csv
│   ├── subtask_3_dev.csv
│   └── train_data_balanced.csv
├── predictions
│   ├── generated_predictions
│   │   ├── sft_predictions.txt
│   │   ├── orpo_predictions.txt
│   │   └── dpo_predictions.txt
│   └── predictions_output
│       ├── sft_pred_EN.txt
│       ├── orpo_pred_BG.txt
│       └── ...
├── sub_dev
│   ├── gemma
│   │   ├── predictions.txt
│   │   └── loss_over_steps.png
│   ├── mistral
│   │   ├── predictions.txt
│   │   └── loss_over_steps.png
│   ├── phi
│   │   ├── predictions.txt
│   │   └── loss_over_steps.png
│   ├── meta
│   │   ├── predictions.txt
│   │   └── loss_over_steps.png
│   └── llama
│       ├── predictions.txt
│       └── loss_over_steps.png
├── extractor_notebook.ipynb
├── narrative_extraction.py
├── process_prediction.ipynb
├── sft_development.ipynb
├── sft+dpo.ipynb
└── sft+orpo.ipynb
```

---

### Data Structure
- **`data/`**
  - `predictions_train.csv`: Predictions generated during training.
  - `subtask_3_train.csv`: Original training dataset.
  - `subtask_3_dev.csv`: Development dataset for evaluation.
  - `train_data_balanced.csv`: Balanced version of the training dataset.

- **`predictions/`**
  - **`generated_predictions/`**:
    - Contains predictions generated by **SFT**, **ORPO**, and **DPO** models.
  - **`predictions_output/`**:
    - Processed predictions grouped by language and model.

- **`sub_dev/`**
  - **`gemma/`**, **`mistral/`**, **`phi/`**, **`meta/`**, **`llama/`**:
    - Each folder contains:
      - `predictions.txt`: Predictions generated by the respective model.
      - `loss_over_steps.png`: Visualization of loss during training.

### Notebooks and Scripts
- **`extractor_notebook.ipynb`**:
  - Extracts and preprocesses the raw data from SemEval-provided zip files.

- **`narrative_extraction.py`**:
  - Main script to train and evaluate narrative extraction models.

- **`process_prediction.ipynb`**:
  - Processes and organizes predictions for each mode (SFT, ORPO, DPO) and model.

- **`sft_development.ipynb`**:
  - Notebook for training the **SFT** model.

- **`sft+dpo.ipynb`**:
  - Notebook for training **SFT** with **DPO**.

- **`sft+orpo.ipynb`**:
  - Notebook for training **SFT** with **ORPO**.

---

## Best Model by Language
Based on evaluation across multiple models and modes, here are the best-performing models for each language:

| **Language** | **Best Model** | **F1 Score** |
|--------------|----------------|--------------|
| **BG**       | **Phi**        | **0.67409**  |
| **EN**       | **Phi**        | **0.73181**  |
| **HI**       | **Llama**      | **0.68616**  |
| **PT**       | **Phi**        | **0.73806**  |

---

## Using narrative_extraction.py

The `narrative_extraction.py` script supports SFT, DPO, and ORPO modes for training and evaluation.

#### Examples

**SFT MODEL**
```python
python narrative_extraction.py --train_file ./subtask_3_train.csv \
                                --dev_file ./subtask_3_dev.csv \
                                --output_root ./sft_outputs \
                                --model llama \
                                --mode sft
```

**DPO MODEL**
```python
python narrative_extraction.py --train_file ./train_data_balanced.csv \
                                --dev_file ./subtask_3_dev.csv \
                                --output_root ./dpo_outputs \
                                --model default_sft \
                                --mode dpo \
                                --token "TOKEN_HF"
```

**ORPO MODEL**
```python
python narrative_extraction.py --train_file ./train_data_balanced.csv \
                                --dev_file ./subtask_3_dev.csv \
                                --output_root ./orpo_outputs \
                                --model default_sft \
                                --mode orpo \
                                --token "TOKEN_HF"
```

---

## Model Links

- **SFT Model**: [irasalsabila/sft_lora_model_adapters](https://huggingface.co/irasalsabila/sft_lora_model_adapters)
- **DPO Model**: [irasalsabila/dpo_lora_model_adapters](https://huggingface.co/irasalsabila/dpo_lora_model_adapters)
- **ORPO Model**: [irasalsabila/orpo_lora_model_adapters](https://huggingface.co/irasalsabila/orpo_lora_model_adapters)

---

## Contact
Team Name: telorbulat
Leaderboard Position: Check our latest scores [here](https://propaganda.math.unipd.it/semeval2025task10/leaderboard.php).